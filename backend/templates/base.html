<!doctype html>
<title>{% block title %}{% endblock %} - Flaskr</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Kanit&family=Montserrat&family=Open+Sans:wght@500&display=swap" rel="stylesheet">

<body>
    <div class="full-body-container">
        <div class="top-text">
            <h1>ðŸŽ¶ WanderingMelody</h1>
            <p>Describe your mood or trip experience and get music recommendations!</p>

            <!-- Mood input -->
            <textarea placeholder="Describe your mood or trip experience" id="mood"></textarea>
            
            <!-- Location input -->
            <input type="text" placeholder="Search Location (Optional)" id="location">

            <!-- Age input -->
            <input type="number" placeholder="Enter Age (Optional)" id="age" min="1" max="100" value="18">

            <!-- Genre input -->
            <input type="text" placeholder="Enter Music Genre" id="genre">

            <button onclick="searchRecommendations()">Search</button>
        </div>
        
        <div id="answer-box"></div>
    </div>

    <script>
        function searchRecommendations() {
            const mood = document.getElementById("mood").value;
            const location = document.getElementById("location").value;
            const age = document.getElementById("age").value;
            const genre = document.getElementById("genre").value;

            // If no mood or genre is provided, alert the user
            if (!mood && !genre) {
                alert("Please provide at least a mood description or a genre.");
                return;
            }

            // Send the input data to the backend via a GET request
            fetch("/recommendations?" + new URLSearchParams({
                mood: mood,
                location: location,
                age: age,
                genre: genre
            }).toString())
            .then(response => response.json())
            .then(data => {
                const answerBox = document.getElementById("answer-box");
                answerBox.innerHTML = "";  // Clear previous results

                if (data && data.length > 0) {
                    // Display the recommended songs
                    data.forEach(song => {
                        let songDiv = document.createElement("div");
                        songDiv.innerHTML = `
                            <h3>${song.title}</h3>
                            <p>by ${song.artist}</p>
                            <p>Album: ${song.album} | Genre: ${song.genre}</p>
                            <p>Rating: ${song.rating}</p>
                        `;
                        answerBox.appendChild(songDiv);
                    });
                } else {
                    // If no songs are found, display a message
                    answerBox.innerHTML = "<p>No songs found, try another genre or mood.</p>";
                }
            });
        }
    </script>
</body>
